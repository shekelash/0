<!-- See https://blog.lanyonm.org/articles/2013/11/21/alphabetize-jekyll-page-categories-pure-liquid.html -->
<!-- With added pipe to handle lack of sort_natural -->
{% capture site_categories %}{% for categories in site.categories %}{{ categories | first | downcase }}|{{ categories | first }}{% unless forloop.last %},{% endunless %}{% endfor %}{% endcapture %}
<!-- site_categories: {{ site_categories }} -->
{% assign categories_words = site_categories | split:',' | sort %}
<!-- categories_words: {{ categories_words }} -->

<div id="categories-page" style="padding-left:1.6em">
  <ul  style="padding-left:0em">
    {% for categories_pair in categories_words %}
    {% assign categories = categories_pair | split:'|' | last %}
    <li>
    <a href="#{{ categories | slugify }}" class="categories-link">
      <span class="categories-name">{{ categories }}</span>
      <span class="categories-count">[{{ site.categories[categories] | size }}]</span>
    </a>
    </li>
    {% endfor %}
  </ul>
</div>

<br>

{% for category in site.categories %}
  <div class="archive-group">
    {% capture category_name %}{{ category | first }}{% endcapture %}
    <div id="#{{ category_name | slugify }}"></div>
    <p></p>

    <h4 class="archive-cat">{{ category_name }}</h4>
    <a name="{{ category_name | slugify }}"></a>
    {% for post in site.categories[category_name] %}
      <ul>
      <li>
       <a class="archive-link" href="{{ post.url | relative_url}}" style="text-decoration:none;">{{post.title}} </a>
       &nbsp;
       [{% for tag in post.tags -%}
       {% capture tag_name %}{{ tag }}{% endcapture %}
       {{ tag_name }}, 
       {%- endfor %}]
      </li>
      </ul>
    {% endfor %}

  </div>
{% endfor %}
